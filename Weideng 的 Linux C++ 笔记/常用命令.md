# 常用命令

[Linux命令大全(手册) ---（基本查询）](https://www.linuxcool.com/)

[Linux命令大全(手册) ---（实例详解）](https://man.linuxde.net/)

## 基本操作

建议输入命令前先敲两下回车，以间隔命令的屏幕显示。

复杂的操作逻辑建议使用 python 编写脚本。

### 快捷键

#### 终端控制

- Ctrl + Alt + F1 ~ F6
  切换终端，即命名为 tty1 ~ tty6 的操作接口环境。
  
  - 默认启动图形界面，则 tty1 会被图形界面占用
  - 默认启动命令行，则 tty1 会被命令行占用
  - 系统不会一下出现 6 个 tty ，按下切换时，会按需要产生新的 tty
  
- Ctrl + c
  中断程序
  
- Ctrl + z

  把当前进程移至后台，可用 fg 命令指定某进制回到前台。bash（命令行程序）被移至后台时，直接再次 Ctrl + z 即可恢复。

- Ctrl + d
  输入结束符 EOF，可以取代 exit 的输入，也可以直接离开命令行模式
  
- Ctrl + l
  产生类似于清屏的效果，使命令输入位置置顶。原来的操作仍可向上翻页查看，不同于 clear。
  
- Ctrl + s
  停止终端，停止屏幕输出。
  
- Ctrl + q
  恢复终端，恢复屏幕输出。
  
- Shift + Page UP  |  Page Down
  翻页
  
- Shift + UP | Down

  翻行

#### 命令输入

- 光标移动

  - Ctrl + a

    光标迅速回到行首（Home 键也行）

  - Ctrl + e

    光标迅速回到行尾（End 键也行）
    
  - Ctrl + r

    可利用其的搜索功能，从当前光标**往前**搜索指定的字符串（依次输入字符），达到跳转光标到指定位置的目的。

  - Ctrl + ]

    从当前光标**向后**搜索指定的某个字符（一次只能搜索一个字符，应指定尽量特殊的字符）。

  - ESC + b 或 Ctrl + Left

    移动到当前单词开头（符号分隔）。

  - ESC + f 或 Ctrl + Right

    移动到当前单词结尾（符号分隔）。

- 参数输入

  - Tab
    按一下补全，按两下显示候补列表
    
  - ESC + .

    获取上一条命令最后的部分（空格分隔）。

  - ESC + t

    将当前光标位置的单词与其前一个单词交换位置（符号分隔）。

- 历史命令

  - Up

  	上一条历史命令

  - Down

  	下一条历史命令

  - Ctrl + r

  	按下后输入字符，从当前光标进行反向搜索，搜索包含指定的字符串的历史命令。
  	
  	- 可依次多个字符，这些字符构成一个匹配串，可输入空格，没有匹配的字符无法继续输入。
  	- 此时可按退格删除要搜索的字符，以供重新输入搜索。
  	- 找到后可按 Up 或 Down 从该命令开始查看其前后的历史命令。
  	- 按 Enter 直接执行命令。
  	- 按 ESC 结束搜索并停在当前搜索到的命令。
  	- 可不按 ESC，直接按 Del（退格会删除要匹配的字符）或移动光标。
  	- 按 Ctrl + c 直接结束搜索并新起一行。
  	- 多次按 Ctrl + r 可继续往前搜索历史命令。

- 输入控制

  - Ctrl + k

    剪切（删除）光标处到行尾的所有字符

  - Ctrl + u

    剪切（删除）光标处到行首的所有字符

  - Ctrl + w 或 Ctrl + Backspace

    剪切（删除）光标前的一个单词（空格分隔）
  
  - ESC + d 或 Ctrl + Del
  
    剪切（删除）光标后的一个单词（空格分隔）
    
  - Ctrl + y
  
    粘贴 Ctrl + k、Ctrl + u、Ctrl + w 等删除的字符
    
  - Ctrl + c
  
    不仅可以终止程序，也可以停止继续输入指令，新起一行，以重新输入。（实现了清空当前指令的功能）
  
  - Ctrl + insert
  
    复制命令行内容
  
  - Shift + insert
  
    粘贴命令行内容


### 命令

- cd

  切换目录

- ls

  列出目录项。

- clear
  清屏

- `--help`
  该参数获取命令的简略帮助。

- man
  获取详细说明书。

  - 代号（可使用 man man 获取更详细的代号说明）
    1. **用户在 shell 中可以操作的命令或可执行文件。**（命令）
    2. **系统内核可调用的函数或工具。**（系统函数）
    3. **常用函数与函数库，大部分为 C 函数库。**（C 库）
    4. 设备文件的说明。
    5. 配置文件或是某些文件的格式。
    6. 游戏。
    7. 惯例与协议，例如 Liunx 文件系统，网络协议等的说明。
    8. 系统管理员可用的管理命令。
    9. 跟内核有关的文件。
  
- info
  获取有层次的说明

- whatis
  查看命令的简短说明，仅说明该命令是干什么的，会列出所有完全同名的命令，相当于 `man -f `。
  
- which
  查看命令路径，只能查找 PATH 的路径中包含的命令的路径，bash 内置命令找不到。

- whereis
  查看命令与命令说明书路径。
  
  - 使用 man 命令即是显示默认排序在前的说明书。
  - man 命令可指定显示某个说明书
  
- exit
  离开系统，即注销 linux ，并不是关机（只是退出账号）

- locale
  查看当前语系

- date
  显示日期与时间

- cal
  显示日历。
  
  - 语法：`cal   [month]   [year]` ，​可显示某年某月的日历，​只给一个数字将显示那一年的日历（共 12 个月）。
  
- `su [username]`
  切换用户（switch user），默认切换到 root 用户，使用 exit 即可返回。
  
  - `su` 切换用户后，不改变原用户的工作目录及其它环境变量。相当于没有切换用户，只是拥有了新用户的权限而已。
  - `su -` 切换用户后，同时切换到新用户的工作目录及其它环境变量。
  
- sudo

  命令前加 sudo，以 root 身份执行该命令。

- stratx
  开启图形界面。

  - startx 生效需要具备的条件：
  	- 没有其它 X Window 被占用
  	- 必须已经安装了 X Window ，并且 X Server 能够顺利启动
  	- 最好有窗口管理器，例如 GNOME ,  KDE , 或是普通的 TWM 等 

- init 3
  回到纯命令行界面
  
- `source ~/.bashrc`

  刷新 bash 配置文件，相当于重新启动 bash 。

### 关机

使用以下命令都是去调用 systemctl（system control）这个系统管理命令。

- sync
	将数据同步写入硬盘
- shutdown
	常用关机命令
- reboot
	重启
- halt   和   poweroff
	关机

### 基本符号

- `$`

  - 一般用户。
  - 取变量值。可 `$variable, ${variable} or $(command)`

- `#`

  root 用户。

- `.`

  当前目录。

- `..`

  上一级目录。

- `~`

  当前用户家目录。

- `~account`

  指定用户家目录。

- `-`

  - 上一次工作目录。
  - 在命令中代指 stdin 或 stdout 。

- 组合键符号说明中：

	`^` 代表 Ctrl，`M` 代表 Alt 。

- `|`

	管道。
	
- `；`

  使多条命令依次执行，显示的结果会首尾连接在一起。

- `/`

  斜杠，表示路径分隔。

- `\`

  反斜杠，转义符，使命令可以在下一行继续输入。（对回车符转义）

- `''`

  单引号，其内 `$` 引导的内容是纯文本。

- `""`

  双引号，其内 `$` 引导的内容是变量值。

- ``

  反引号，命令组合中先执行的命令，也可使用 `$()`。例：`ls -l $(cat file-list.txt) ` 。

- 通配符（Wildward）

  通配符是 shell 提供的功能，由 shell 展开，而正则表达式需要程序专门有所支持，通配符内容少，简单易用，正则表达式较复杂，功能强。

  - `*`

  	任意个字符（包括 0）。

  - `?`

  	某一个字符（至少有一个）。

  - `[ ]`

  	其中的某一个字符。如：`[abc]`

  - `[ - ]`

  	具有连续性质的范围的，其中的某一个字符。如：`[a-z1-9]`

  - `[^ ]`

  	非其中的某一个字符。如：`[^abc]`

### 重定向

每个进程都有自己的标准输入，输出和错误流。

- `>`

	替换。

- `>>`

	追加。

```shell
0 - stdin 标准输入流
1 - stdout 标准输出流
2 - stderr 标准错误流
/dev/null - 标准空文件流

>
默认为 stdout 重定向，与 1> 相同。

2>&1
将 stderr 重定向到 stdout
```

### 历史命令

尽量不用使用撤销命令，不是所有命令都可恢复，且自动恢复不靠谱，根据历史命令往回做即可。

#### history

显示当前用户从登录开始执行的命令。

- `history n`

	显示最近 n 条命令，包括命令编号。

- history 可与 grep 等命令连用。

#### bang 命令

- 命令

  - `!n`

    重新执行历史命令中编号为 n 的命令。

  - `!name`

    执行最近的名为 name 的命令。

- 参数

  - `!^ or !$`

    键入上一条命令的第一或最后一个参数。

  - `!*`

  	键入上一条命令的所有参数。

  - `!:n`

  	键入上一条命令的第 n 个参数（实质是字符串）。（0 就是命令名）

  - `!:n1-n2`

  	键入上一条命令第 n1 到 n2 个参数。

  - `!name:n`

  	键入最近一条名为 name 的命令的第 n 个参数。

- 替换

  - `^A^B`

    将上一条命令的字符串 A 替换为 B 后执行。（只第一个匹配的字符串，被替换的可为子串）

  - `^A^B^`

    将上一条命令中所有 A 替换为 B 后执行。

  - `^A`

    删除 上一条命令中的 A 后执行。（反替换）

- `!(*.txt)`

  在命令末尾附加，不对括号内指定的项执行该命令，多个项可用通配符或 `|` 隔开。

## 目录命令

| 命令  | 作用                                           |
| ----- | ---------------------------------------------- |
| cd    | 切换目录。                                     |
| ls    | 列出目录信息或文件属性。（常用 `-a -l -h -d`） |
| tree  | 用树状图列出目录结构。（常用 `-L -d`）         |
| pwd   | 显示当前所在目录（的路径）。                   |
| mkdir | 建立一个新目录。                               |
| rmdir | 删除一个空目录                                 |
| cp    | 复制，建立链接（常用 `-a -i -p -r -u`）        |
| rm    | 删除（常用 `-r`）                              |
| mv    | 移动，重命名                                   |
| touch | 修改文件时间或创建新文件。                     |

- 文件时间

	- 读取时间（access time，atime）

	- 状态时间（status time，ctime）
	
		权限或属性改变的时间。

	- 修改时间（modification time，mtime）
	
		ls 默认显示 mtime 。

## 文件查看

| 命令 | 作用 |
| - | - |
| cat | 连接文件并输出，单个文件直接输出。参数 A 可显示所有特殊符号。 |
| tac | 逆序连接文件并输出（针对行的逆序）。（ tac 为 cat 的逆序） |
| nl | 显示的时候，同时输出行号，支持行号的多种显示。|
| more | 一页一页地显示文件内容。|
| less | 同  more，但可以往前翻页。（man 命令使用 less 显示） |
| head | 只看开头几行。 |
| tail | 只看结尾几行。`-f` 用于追踪查看一个不断更新的文件的更新内容。 |
| od  | 以二进制方式读取文件内容。|
| vi，vim | 用 vi，vim 操作文件，若使用 vim，某些文件内容会有颜色标注。 |
| file | 查看文件类型信息。 |

```shell
# 查看文件夹内文件总大小，默认当前文件夹
du -sh [dir]
```

## 查找

### 基本命令

| 命令     | 作用                                                 |
| -------- | ---------------------------------------------------- |
| which    | 查找可执行文件。                                     |
| type     | 查询是否是 bash 内置命令。                           |
| apropos  | 查找含有指定关键词的所有说明文件，相当于 `man -k` 。 |
| locate   | 在已建立的查找数据库中查找。                         |
| updatedb | 查找文件并手动更新查找数据库。                       |

### find

多功能查找。

`find [path] [expression] `

find 默认在当前目录下查找。

常用 expression 如下：

- `-name <n>`

	查找文件命令符合 n 的文件，使用 `iname` 会忽略大小写。

- `-path <p> `

	查找路径名称符合 p 的文件，使用 `ipath` 会忽略大小写。

- `-type`

	指定文件类型。（使用 Linux 的文件类型表示符号）

- `-exec <command> {} \`

	对查找到的文件执行该 command 。

- `-depth`

	以宽度优先搜索的顺序查找，即进入子目录前先查找完本目录的内容。

## 文本处理

### grep

（globally search a regular expression and print，以正则表达式进行全局查找以及打印）

常用于过滤文本，提取含有指定目标的行。

`grep [option]... <pattern> [file]... `

- pattern

	正则表达式。多个单词时要加引号，单双均可。

- `-i`

	忽略大小写。

- `-v`

	反模式搜索，表示将不包含 pattern 的行输出。

- `-n`

	也输出 pattern 对应的行数。

- `-B 3 or -A 4`（before，after）

	将 pattern 对应行的前 3 行和后 4 行也输出。

- `-r`

	递归搜索目录下的所有文件。

### cut

常用于对行进行分割提取，会提取文件所有行的某些列（字段）。

`cut [参数] [file]`

- `-d`

	指定分隔符，默认以 Tab 分割。指定空格可用引号，但 cut 无法处理重复的空格。

- `-f`

	提取指定的字段（规则同 `-c`）。

- `-c`

	指定按字符的切割位置。

	- `-c a-b`

		提取第 a 到第 b 个字符。

	- `-c -a `

		提取第 1 到第 a 个字符。

	- `-c a-`

		提取第 a 到行末尾的字符。

	- `-c a,b,c...`

		提取第 a，第 b 以及第 c 个字符。各方式可混合，以逗号分隔即可。

- `-b`

	指定按字节的切割位置。某些编码的字符具有多个字节。

### tr

删除和替换字符，常用以先处理重复空格，和 cut 配合使用。

可使用正则表达式。

- `tr <字符a> <字符b>`

	将字符 a 替换为字符 b 。

- `tr -s <字符>`

	删除指定的字符。

- `tr -d <字符>`

	去除重复的字符。

### sed



### awk



## 软硬链接

| 命令                                       | 作用                                        |
| ------------------------------------------ | ------------------------------------------- |
| `ln`（link）                               | 建立硬链接。                                |
| `ln -s <source_path 绝对路径> <link_path>` | 建立符号链接（Symbolic Link），也叫软链接。 |
| `unlink`                                   | 删除软链接文件                              |

软链接的注意事项：

- 软链接可以链接文件，也可以链接目录。
- source 路径
	- `source_path` 建议使用绝对路径，否则一但 `link_path` 改变，软链接则失效。
	- ` source_path`使用 `xxx/path`  或 `xxx/path/` 都可以，只是 ls 会多显示 `/` 。

- link 路径
	- 默认命名： `link_path/` 指定一个目录路径，在该路径下创建软链接文件。（默认名为 `source_path` 的文件名或目录名）
	- 指定命名： `link_path` 指定一个文件路径，创建该文件。

- 软链接是个文件，不是目录，在删除或移动软链接文件时，使用 `rm xxx/link` ，而不是 `rm xxx/link/` 。
- 建议使用 `unlink` 删除软链接文件，避免出错。
- find 默认不会进入软链接的目录查找文件。

## 压缩打包

- 压缩，解压
- 打包，解包

| 约定扩展名 | 意义 |
| - | - |
| `.zip` | zip 压缩文件 |
| `.gz` | gzip 压缩文件 |
| `.bz2` | bzip2 压缩文件 |
| `.xz` | xz 压缩文件 |
| `.tar` | tar 打包文件 |
| `.tar.gz` 或 `.tgz` | 打包后又压缩的文件 |
| `.tar.bz2` 或 `.tbz2` | |
| `.tar.xz` 或 `.txz` | |

### 压缩命令 zip unzip

zip：

- `-v`，显示详细信息。
- `-m`，不保留原文件。
- `-r`，递归处理。

unzip：

- `-v`，显示详细信息。
- `-d`，解压到指定目录。

### 压缩命令 gzip，bzip2，xz

- 压缩率增大，压缩时长增大（gzip > bzip2 > xz）。

- 若对目录使用，代表将目录内的每个文件单独压缩。

| 参数 | 意义                                                      |
| ---- | --------------------------------------------------------- |
| -d   | 解压缩。                                                  |
| -c   | 将数据输出到屏幕上，常配合 \| 来重定向。                  |
| -v   | 显示压缩信息。                                            |
| -k   | 保留原始文件（原文件或压缩文件）。（仅 bzip2 和 xz 支持） |

### 打包命令 tar

打包文件称为 tarfile，打包并压缩的文件称为 tarball 。

示例：

```shell
# 打包并压缩
tar -jcv -f <outFileName.tbz2> <inFile>

# 查询（查询包含文件的信息）
tar -jtv -f <inFile.tbz2>

# 解压并解包
tar -jxv -f <inFile.tbz2> -C <outDir>
```

| 参数       | 意义                                                         |
| ---------- | ------------------------------------------------------------ |
| -c         | 打包文件。                                                   |
| -x         | 解包或解压文件。                                             |
| -t         | 查看包含有的文件名。                                         |
| -v         | 显示操作信息。（查询时加上 -v 会比单独 -t 显示更多文件的权限属性等信息） |
| -z         | 通过 gzip 。                                                 |
| -j         | 通过 bzip2 。                                                |
| -J         | 通过 xz 。                                                   |
| -f         | 指定使用的文件，-f 与文件名间不允许有空格外的字符。          |
| -C         | 指定特定目录。                                               |
| -p         | 保留备份数据原本的权限与属性，常用于配合 -c 备份文件。       |
| -P         | 保留绝对路径，一般不保留更安全，能避免解压缩时绝对路径覆盖已有文件。 |
| --exclude= | 指定不打包的文件。                                           |

## 软件管理

- Linux 系统基本上分两大类
	- RedHat 系列
		
		Redhat、CentOS、Fedora 等。
		
		- **rpm 安装包**，安装命令：`rpm -参数`。
		- 包管理工具 **yum **。
	- Debian系列。
		
		Debian、Ubuntu 等。
		
		- **deb 安装包**，安装命令：`dpkg -参数`。
		- 包管理工具 apt-get（可简写为 **apt**）。

## 环境变量

操作系统本身也是个程序，而环境变量就是这个程序运行时的一些全局变量。

子进程会继承父进程的**环境变量**（可继续使用），但不会继承父进程的**自定义变量**。

### 分类

- 按生命周期

	- 永久的

		需要修改配置文件。

	- 临时的

		在终端中声明的环境变量，关闭 shell 终端失效。

- 按作用域

	- 系统级

		对整个系统即所有用户有效。

	- 用户级

		只对某个用户有效。

### 文件

用户登录时下述文件执行的顺序（下述文件在用户登录后执行的先后顺序）：

1. `/etc/enviroment`

2. `/etc/profile`

	会调用 `/etc/bash.bashrc` 文件，和 `/etc/profile.d/` 目录下的 `.sh` 脚本文件。

3. `/etc/bash.bashrc`

	被调用加载。

4. `~/.profile`

	会调用`~/.bashrc` 文件。

5. `~/.bashrc`

	被调用加载。

#### 系统级

- `/etc/environment`

	设置系统的环境。

- `/etc/profile`（部分系统为：`/etc/bash_profile`）

	设置所有用户的环境。

- `/etc/bash.bashrc`

	为每一个运行 bash 的用户执行此文件，在用户每次打开一个 bash 时执行一次。

#### 用户级

- `~/.profile`（部分系统为：`~/.bash_profile`）

	设置单个用户的环境，只在用户登陆时执行一次。

- `~/.bashrc`

	对应当前登录用户的 bash 初始化文件，在用户每次打开一个 bash 时执行一次。

### 相关命令

- env

  不带参数执行，显示所有环境变量。

- export

  - 不带参数执行，显示所有环境变量。
  - 将自定义变量转换为环境变量。例如 `export variable` 也可 `export [variable name]=[value]`

- set

  - 不带参数执行，显示所有环境变量和其它在 bash 中的变量。
  - `set -a [variable]` 将自定义变量设置为环境变量。

- declare

  - 不带参数执行，显示所有环境变量和其它在 bash 中的变量。
  - `declare -x [variable]` 将自定义变量 variable 设置为环境变量。
  - `declare +x [variable]` 将环境变量 variable 设置为自定义变量。（相当于“取消”操作）

- source

  使配置文件立即生效。

### 配置方法

- 配置临时环境变量

	只在当前 shell 环境下生效，切换或关闭后重新进入就会失效。

	- 在终端中使用 export、set、declare 等命令。

	- 以 PATH 环境变量为例

		`export PATH=$PATH:路径` ，也可 `export PATH=路径:$PATH`，区别是添加在末尾还是开头。


- 配置永久环境变量

	把设置环境变量的命令写到相应配置文件中，在每次开机或打开 shell 时会自动设置。

	- 一般选择配置的文件

		- 针对系统

			`/etc/bash.bashrc`

		- 针对用户

			`~/.bashrc`


- 更新环境变量

	使用 `source <file>` 使其立即生效。

## 网络命令

### 网络状态

- hostname

	显示主机名。

	- `-d` 

		显示所属域名。

	- `-f`

		显示完整的主机名和域名。

	- `-i`

		显示主机的 IP 地址。

	- `-I`

		显示主机所有的 IP 地址。
	
- ping

	发送 ICMP 协议数据包，常用来检测与目标主机是否网络连通。

- telnet

	可用来检测目标主机是否开放指定端口。（TCP）

- ifconfig

	查看和设置网络设备。

- nslookup

	可以找到给定域名的所有 IP 地址，可以给出指定 IP 地址的主机名。

- netstat

	显示整个系统的网络状态。

	- `-a`

		显示所有 Socket 。

	- `-t`

		显示所有 TCP 连接。

	- `-u`

		显示所有 UDP 连接。

	- `-p`

		显示 PID 和程序名。

### 防火墙

Linux 默认是关闭防火墙的。

### SSH

一种计算机连接协议，服务端监听客户端连接请求，包含两部分：

- openssh（提供连接服务）
- openssl（提供加密服务）

常用 22 端口。

- `ssh <user>@<hostname>`

	连接到主机。

	- `-p`

		指定端口。

	- 在连接命令尾部添加命令

		可在远端执行命令，并在本地显示结果。

- 免密登录

	- 生成密钥对（公钥和私钥）
	  - `ssh-keygen`
	  - 双方都要生成（除非已经生成过）。
	  - 有时候在 Windows 生成的密钥不起作用，可以在 Git bash 里生成。
	- 发送公钥。
		- `ssh-copy-id -i ~/.ssh/id_rsa.pub root@hostname`
		- 也可手动将公钥复制到 `authorized_keys` 文件内。

### 获取文件

- wget

  用于从网络上获取文件。

  - `wget [url]`

  	从 URL 获取文件到当前目录。

  - `wget -O [name] [url]`

  	指定保存名称。

  - `wget -P [path] [url]`

  	指定保存目录。

  - `wget -c [url]`

  	从已经下载的文件内容的位置继续下载。
  	
  - `wget -b [url]`

    后台下载，bash 关闭仍继续下载。

    - 此时可使用 `tail -f wget-log` 查看下载信息，断点续传（多次下载）或有多个下载时， log 文件为 `wget-log.{编号}`。
    
  - `wget -t <number> [url]`
  
    连接中断时自动重连的次数，number 为 0 则表示使用默认最大次数。
  
  - 常用 `wget -bc -t 0 -O [name] [url]` ，url 较复杂时，应使用引号。
  
- curl

	可以模拟浏览器请求，调试网页等。

	- `curl -O [url]`

		保存文件到当前目录。

	- `curl -o [name] [url]`

		以指定名称获取文件。

## 进程管理

### top

实时显示进程使用系统资源的信息。

#### 显示的信息

- 第一行 load average

	系统 1 分钟、5 分钟、15 分钟的 CPU 负载信息。

- 第三行 %CPU(s) 

	表示 CPU 的平均信息，若要单独看一个 CPU ，重复按 1 即可。

	- us：用户态进程占用 CPU 时间百分比，不包含 NI 值（用户优先级）为负的任务占用 CPU 的时间。
	- sy：内核占用 CPU 时间百分比。
	- ni：改变过优先级的进程占用 CPU 的百分比。
	- id：空闲 CPU 时间百分比。
	- wa：等待 I/O 的 CPU 时间百分比。
	- hi：CPU 硬中断时间百分比。
	- si：CPU 软中断时间百分比。

- 第四行 Men：内存 。

- 第五行 Swap：交换空间。

- 进程基本信息

	- PID：进程号
	- USER：所有者
	- PR：进程内核优先级（Priority），越小越优先执行。
	- NI：进程用户优先级（Nice），值越大越谦让（即 nice），优先级越低。
	- VIRT：占用的虚拟内存。
	- RES：占用的物理内存。
	- SHR：使用的共享内存。
	- S: 进程状态。
	- %CPU：CPU 使用率。
	- %MEM：使用的物理内存和总内存的百分比。
	- TIME+：该进程启动后的累计 CPU 占用时间。
	- COMMAND：启动该进程的命令。

#### 进程状态

| 标识码 | 意义                           | 英文描述                               |
| ------ | ------------------------------ | -------------------------------------- |
| D      | 不可中断的睡眠                 | uninterruptible sleep（usually IO）    |
| R      | 运行中或可运行（在运行队列中） | running（in queue）                    |
| S      | 可中断睡眠                     | sleeping（等待事件）                   |
| T      | 被信号终止                     | stopped by job control signal          |
| t      | 被调试停止                     | stopped by debugger during the tracing |
| Z      | 僵尸进程                       | zombie                                 |

对于 BSD 中的标识码格式，还可以有额外的标识符。

- **伯克利软件套件（Berkeley Software Distribution，BSD，FreeBSD）**

	与 Linux 类似的另一种类 UNIX 操作系统。

| 标识符号 | 意义                               | 英文描述                                                     |
| -------- | ---------------------------------- | ------------------------------------------------------------ |
| <        | 高优先级                           | high-priority (not nice to other users)                      |
| N        | 低优先级                           | low-priority (nice to other users)                           |
| L        | 进程要求将自己的资源保持在内存中。 | has pages locked into memory (for real-time and custom IO)   |
| s        | 所在会话的 leader 。               | is a session leader                                          |
| l        | 该进程包含多个线程。               | is multi-threaded (using CLONE_THREAD, like NPTL pthreads do) |
| +        | 正运行在前台的进程。               | is in the foreground process group                           |

#### 常用交互命令

这些命令也可以以参数形式输入 top 。

| 命令      | 作用                       |
| --------- | -------------------------- |
| q         | 退出 top 。                |
| h         | 查看帮助。                 |
| P         | 按 CPU 使用率排序。        |
| M         | 按 %MEM 排序。             |
| T         | 按 TIME+ 排序。            |
| u         | 指定显示的用户进程。       |
| k         | kill 进程。                |
| i         | 只显示正在运行的进程。     |
| c         | 显示完整的启动进程的命令。 |
| `<Space>` | 立即刷新。                 |
| s         | 设置刷新时间间隔。         |

### ps

一次性显示进程信息。

| 参数     | 意义                                                         |
| -------- | ------------------------------------------------------------ |
| -a       | 显示当前终端所有进程，除了 session leaders                   |
| a        | 显示当前终端所有进程，包含其它用户。                         |
| -A 或 -e | 显示所有进程。                                               |
| r        | 显示正在运行的进程。                                         |
| u        | 指定用户的所有进程。                                         |
| au       | 显示详细的信息。                                             |
| aux      | 显示所有进程的详细信息，包含其它用户。目前所有在内存的进程。 |
| -f       | 显示完整格式的输出，包括命令。                               |

### pstree

显示进程关系树状图。

- `pstree [PID or userName]`

	指定 PID 或用户名，以其为根显示所有进程，默认以 init 进程为根。

| 参数 | 意义                                   |
| ---- | -------------------------------------- |
| p    | 显示进程号。                           |
| c    | 不使用精简标识符，同名进程不合并显示。 |
| h    | 标明正在执行的进程。                   |
| u    | 显示用户名称。                         |

### kill

终止某个进程或作业。

```shell
# 默认发送终止信号 15 SIGTERM，不建议使用缺省参数。
kill <pid>
kill %job_ID

# 信号 9 强制终止进程
kill -9 <pid>
kill -9 %job_ID
```

### 其它命令

- free

	只查看内存和交换空间使用情况。

- uptime

	只查看 uptime 信息（第一行）。

- htop

	比 top 更强大的一个实时交互式进程浏览器。

	- 支持鼠标操作。
	- 可以横向或纵向滚动浏览进程列表，以便看到所有的进程和完整的命令行。
	- 在启动上，比 top 更快。
	- 杀进程时不需要输入进程号。

### 后台进程

- 后台进程不是离线进程，也不是守护进程，会在用户退出终端后终止。
- 后台进程的终止
	- 自然终止。
	- 终端中断。
	- 使用 `kill` 。

#### &

后台运行命令。

在命令末尾使用 `&` ：

```shell
command &
```

后台进程仍会在终端显示信息，此时仍可以向 stdin 输入指令，只是显示比较乱，可以使用 `fg` 将作业移回前台。

可在执行前重定向：

```shell
command > out.txt &
# 或
command > 1 &
```

#### jobs

显示后台运行的进程。

```shell
jobs
[1]	Runing	firefox &
[2]- Runing	gedit &
[3]+ Stopped	vim

# [number] 为 job ID，使用时用数字 %number ，大多数情况可以直接 number 。
# + 表示运行的最后一个作业。
# - 表示运行的倒数第二个作业。

# 显示更多信息，包括进程号。
jobs -l
```

被终止的进程的信息，会在使用 `jobs` 查看一次后，不再保留，不能再查看。

#### bg

将进程发送到后台。（background，bg）

将作业列表中的进程发送到后台运行，该进程可以为前台，也可以为后台 stopped 进程。

```shell
# 暂停进程
Ctrl + z

# 默认将作业列表最后一个作业发送到后台
bg

# 将 job ID 为 1 的进程发送到后台
bg %n
# 也可
bg n 
```

#### fg

将后台进程转到前台。（foreground，fg）

```shell
# 默认作业列表的最后一个作业转到前台
fg

# 将 ID 为 n 的进程转到前台
fg %n 
# 也可
fg n 
```

### 离线进程

- 使用 nohup 或 disown 的后台进程不会在退出终端后终止，但建议使用 `exit` 退出终端，以保证程序继续后台运行。
- 建议使用 screen 或 tmux 保证进程在退出终端后继续运行。
- 离线进程的终止
	- 自然终止。
	- 使用 `kill` 。

#### nohup

（no hang up，nohup，不挂起）

用于在后台不挂起地运行程序。

- 命令格式：`nohup Command [&]` 
	- `nohup` 让程序不挂起。
	- `&` 让程序后台运行。

常用形式：

```shell
# 后台执行，会生成 nohup.out 文件，记录输出。
nohup command &

# 重定向标准输出
nohup command > myout.txt &

# 重定向标准输出和标准错误
nohup command > myout.txt 2>&1 &
```

关闭终端时，系统会向进程发送 SIGHUP 信号，nohup 使进程忽略该信号，使得进程在终端关闭后继续运行。

忽略 SIGHUP 信号的进程无法用 `jobs` 查看，可以使用 `ps` 等命令。

#### disown

让一个后台作业在关闭终端后继续运行。

disown 也是让进程忽略 SIGHUP 信号。

```bash
# 非后台作业可以先移至后台

disown -h %job_ID
```

#### screen

一个多重视窗管理程序，可用在退出终端后，让作业保持运行（离线运行）。

在 screen 会话内，可以像在 shell 内一样操作。

- detach（分离）

	当 screen 会话被 detach（分离）后，即使终端中断，其内的程序仍然保持运行，并可重新连接该 screen 会话，重新标准输出也会保留。

- 终止

	当 screen 会话被终止时，其内的程序不再运行。

模拟 shell 窗口：

```shell
# 创建一个 screen session
screen

# 创建一个 screen 并命名
screen -S name

# 内部 detach screen
Ctrl + a d

# 列出所有 screen
screen -ls

# 数字表示 screen id ，session 是 screen 的默认 name
7880.session    (Detached)

# 连接（attach） screen ，默认连接最近的 screen 会话
screen -r [id | name]

# 内部终止 screen 会话
在 screen 会话中按 Ctrl + a k

# 外部 detach screen
screen -d [id | name]

# 外部终止 screen 会话
screen -S 23536 -X quit
```

绑定命令：（conda 环境会失效，需要重新激活环境）

```shell
# 创建一个 screen 并绑定运行 command
screen [command]

# command 结束后，screen 自动终止。（在需要重新连接查看命令输出时，建议不绑定命令）
# command 在 detach 后离线运行。

绑定命令时，可在 screen 会话中按 Ctrl + a k 或 Ctrl + c 终止 screen 。
```

#### tmux

一个终端复用器（terminal multiplexer），与 screen 类似，可做备用。

每个 tmux 会话内可开多个 window 。

```shell
# 创建一个 tmux 会话
tmux

# 创建一个 tmux 会话并命名
tmux new -s <name>

# 内部 detach tmux
Ctrl + b d 或输入 tmux detach

# 列出所有 tmux 会话
tmux ls

# 接入会话，默认接入最近的会话
tmux a [-t <id | name>]

# 内部终止 tmux 会话
输入 exit

# 外部终止 tmux 会话（内部无法终止时，用外部终止）
tmux kill-session -t <id | name>

# 进入翻页模式
Ctrl + b, [
# 翻页
使用 PgUp 或 PgDn
# 退出翻页模式
q
```

tmux 不能绑定命令。

## 硬件信息

### CPU

```shell
# 查看 cpu 信息。
lscpu
```

### GPU

```shell
# 查看 gpu 信息。
nvidia-smi
```

### 磁盘空间

常用 `df -hl` 。

| 参数 | 意义                              |
| ---- | --------------------------------- |
| h    | human-readable ，以 1024 为进制。 |
| l    | local，本地文件系统。             |

## 系统日志

系统日志一般存放于 `/var/log` ，一般系统搭载的服务的日志也放在这个目录下。

|      日志文件      |                             说明                             |
| :----------------: | :----------------------------------------------------------: |
| messages 或 syslog | 记录系统各种重要信息，系统出现问题时，应当首先检查该日志文件。 |
|        cron        |                    记录系统定时任务信息。                    |
|        cups        |                     记录打印信息的日志。                     |
|       dmesg        | 记录系统在开机时内核自检的信息，也可以使用 dmesg 命令直接查看内核自检信息。 |
|       mailog       |                        记录邮件信息。                        |
|        btmp        |   记录错误登录日志，是二进制文件，要使用 lastb 命令查看。    |
|      lastlog       | 记录所有用户最后一次登录时间的日志，是二进制文件，要使用 lastb 命令查看。 |
|        wtmp        | 永久记录所有用户的登录、注销信息，同时记录系统的启动、重启、关机事件。是二进制文件，要使用 lastb 命令来查看。 |
|        utmp        | 记录当前已经登录的用户信息，这个文件会随着用户的登录和注销不断变化。要使用 w,who,users 等命令来查询 |
|       secure       | 记录验证和授权方面的信息，只要设计账号身份和密码的行为都会记录，包括其它程序的行为。 |
|     `yum.log`      |                    yum 软件包相关的信息。                    |
|     `boot.log`     |                     系统启动的相关信息。                     |

## 定时命令

### watch

`watch [参数] <command>`周期性地执行指定 command，全屏显示结果。

一般用于短间隔重复执行的查看类的命令。

| 参数 | 意义                                          |
| ---- | --------------------------------------------- |
| n    | 指定间隔时间，默认单位为秒，默认时间为 2 秒。 |
| d    | 高亮显示变化内容。                            |
| g    | command 结果变化时停止更新。                  |
| e    | command 发生错误时停止更新。                  |

### at

指定时间执行一次命令：

- 分钟级，每分钟检查一次是否有要执行的命令。
- 一次性任务。
-  at 执行的命令不会输出到 stdout 。

at 的使用需要开启守护进程 atd （at daemon）。

```shell
# 安装at
yum install at

# 启动守护进程
systemctl start atd

# 可不设置：
# 查看是否开机启动
systemctl list-unit-files|grep atd
# 设置开机启动
systemctl enable atd
```

命令格式：

```shell
# 1. 命令行使用
# -t 一般可省略
<command> | at  [-t]<time>

# 2. 从文件读入（只能一行命令）
at -f <command.txt> [-t]<time>

# 3. 交互式输入（输入不方便，不建议）
```

示例：

```shell
# 一分钟后执行 ls 并写入文件
ls > at_test.txt | at now + 1 minutes

# 示例，今天下午 2:20 执行 at_test.txt 内的命令
at -f at_test.txt 2:20pm tody
```

指定时间的格式：

```shell
# 小时:分钟 (当天，如果时间已过，则在第二天执行)
hh:mm

# midnight(深夜),noon(中午),teatime(下午茶时间，下午4点),today,tomorrow等
# 12小时计时制，时间后加 am 或 pm

# 绝对时间
mm/dd/yy (月/日/年)
或
dd.mm.yy (日.月.年)

# 相对时间
now + n units
now 表示现在时刻，n 为数字，units 为单位(minutes、hours、days、weeks)
```

任务管理：

```shell
# 查看 at 任务队列
at -l
或
atq

# 查看命令内容
at -c <任务号>

# 删除任务
at -d <任务号>
或
atrm <任务号>
```

### crontab

（cron table）

- 分钟级，每分钟检查一次是否有要执行的命令。
- 周期性任务。

### systemd.timer

- 秒级任务。
