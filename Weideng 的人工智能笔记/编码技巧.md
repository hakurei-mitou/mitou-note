# 编码技巧

## 项目结构

简明，模块化，易扩展。

- 项目说明
- 项目使用到的包

```python
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt

import math

import torch
import torch.nn as nn
from torch.utils.data import random_split, Dataset, DataLoader
```

- 模型配置

	使用 `Config` 类，设置类变量保存配置参数和超参数。（使用字典则无代码提示）

```python
class Config:   # 配置类
    device = 'cuda' if torch.cuda.is_available() else 'cpu'   # 类变量
    seed = 923
    data_path = './data'
    save_path = './save_model'
    learning_rate = 1e-5
    
	def __init__(self):   # 必要时可扩展
        pass

print(f"Using {Config.device} device")   # 使用类变量

class ConfigTest:   # 扩展
    pass
```

- 模型结构

- 常用函数

```python
def same_seed(seed): 
    torch.backends.cudnn.deterministic = True   # 卷积都使用默认的卷积算法
    torch.backends.cudnn.benchmark = False   # 关闭系统卷积算法选择优化（带随机性）
    np.random.seed(seed)   # 为程序算法设置种子。
    torch.manual_seed(seed)   # 为 CPU 设置种子。
    if torch.cuda.is_available():
        torch.cuda.manual_seed_all(seed)   # 为所有 GPU 设置种子。

def split_train_valid(data, valid_ratio, seed):
    valid_size = int(len(data) * valid_ratio)
    train_size = len(data) - valid_size
    train_set, valid_set = random_split(data, [train_size, valid_size], generator=torch.Generator().manual_seed(seed))
    return np.array(train_set), np.array(valid_set)
```

- 数据处理
- 训练
- 输出统计信息
- 绘图
- 测试、预测
- 使用 main 函数统筹项目，便于结合 Config 扩展到多参数对比训练。

```python
def main():
	same_seed(Config.seed)
	...
	...
    
main()   # begin code
```

## 杂项

- 尽量所有类和函数都定义好后，再正式载入数据进行训练。
- PyTorch 中方法名末尾如果带下划线，表示会修改变量本身（in-place）：`.abs_(), .abs()  ` 。
- 编码测试使用小部分数据集和小参数，测试完后再正式训练。