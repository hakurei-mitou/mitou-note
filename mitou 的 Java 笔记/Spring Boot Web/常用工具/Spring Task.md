# Spring Task

Spring Task 是 Spring 框架提供的任务调度工具，可用于编写定时任务。

## cron 表达式

cron 表达式是一个字符串，描述任务触发的时间。

### 构成规则

分为 6 或 7 个域，由空格分隔，每个域代表一个含义。

```
# 以 2022 年 10 月 12 日上午 9 点整为例：

秒 分钟 小时  日  月  周  年(可选)
0   0   9   12  10  ?	2022
```

其中，一般**日**和**周**的值不同时设置，其中一个设置，另一个用 ？表示。

可参考：cron 表达式在线生成器：https://cron.qqe2.com/

### cron 通配符

可使用 cron 通配符表示更复杂的含义。

- `*` 表示所有值； 

- `?` 表示未说明的值，即不关心它为何值； 

	只能用在日期（日，月，年）和星期中，且不能同时出现。

- `-` 表示一个指定的范围； 

- `,` 表示附加一个可能值； 

- `/` 符号前表示开始时间，符号后表示每次递增的值；

`*` 和 `?` 的区别：

cron 表达式被展开时，`*` 表示展开所有可能的值，`?` 表示该字段自动计算。

对于 `0 0 9 * 2 *` ，，指定的日被展开，指定的星期被展开，可能存在日和星期不匹配的情况，所以应该使用： `0 0 9 ? 2 *`  或  `0 0 9 * 2 ?`  。

### 案例

```
*/5 * * * * ? 每隔5秒执行一次

0 */1 * * * ? 每隔1分钟执行一次

0 0 5-15 * * ? 每天5-15点整点触发

0 0/3 * * * ? 每三分钟触发一次

0 0-5 14 * * ? 在每天下午2点到下午2:05期间的每1分钟触发 

0 0/5 14 * * ? 在每天下午2点到下午2:55期间的每5分钟触发

0 0/5 14,18 * * ? 在每天下午2点到2:55期间和下午6点到6:55期间的每5分钟触发

0 0/30 9-17 * * ? 朝九晚五工作时间内每半小时

0 0 10,14,16 * * ? 每天上午10点，下午2点，4点 
```

## Task 案例

1. 导入 maven 坐标（spring-context）。
2. 启动类添加 @EnableScheduling 注解，开启任务调度。
3. 自定义定时任务类。

```java
/**
 * 自定义定时任务类
 */
@Component
@Slf4j
public class MyTask {

    private static int count = 0;

    /**
     * 定时任务 每隔5秒触发一次
     */
    @Scheduled(cron = "0/5 * * * * ?")
    public void executeTask(){
        log.info("定时任务 {} 开始执行：{}", ++count, new Date());
    }
}
```

